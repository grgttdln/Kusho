# Suggested Prompts for WordBankGenerationModal

## Date: 2026-02-22

## Summary

Add two AI-generated suggested prompt chips below the word count stepper in `WordBankGenerationModal`. Prompts are contextually generated by Gemini based on the current word bank contents. Tapping a suggestion auto-fills the prompt text field. Includes caching to avoid redundant API calls on repeated modal opens.

## Architecture

- **Repository**: New `generateSuggestedPrompts(words: List<Word>)` method in `GeminiRepository.kt`
- **ViewModel**: New state fields (`suggestedPrompts`, `isSuggestionsLoading`) and `loadSuggestedPrompts()` method with cache invalidation
- **UI**: New parameters on `WordBankGenerationModal` composable; suggestion chips rendered below stepper
- **Caching**: ViewModel caches last suggestions and word count. Regenerates only when word bank size changes.

## New Repository Method

`GeminiRepository.generateSuggestedPrompts(words: List<Word>): List<String>`

- Uses `gemini-2.5-flash-lite` with JSON response format
- System prompt instructs Gemini to return exactly 2 concise prompt suggestions
- If word bank is empty: suggest generic CVC starter prompts (e.g., "Common short vowel words for beginners")
- If word bank has words: include word list + CVC analysis so Gemini suggests complementary patterns
- Returns `List<String>` (2 items)
- Uses existing `retryStep()` pattern for error handling

## New ViewModel State

```kotlin
// In LessonUiState
val suggestedPrompts: List<String> = emptyList()
val isSuggestionsLoading: Boolean = false
```

Private cache fields in ViewModel:
```kotlin
private var cachedSuggestedPrompts: List<String> = emptyList()
private var cachedWordCountForPrompts: Int = -1
```

## New ViewModel Method

`loadSuggestedPrompts()`:
1. Compare `uiState.words.size` to `cachedWordCountForPrompts`
2. If match and cache non-empty: set `suggestedPrompts = cachedSuggestedPrompts` immediately
3. If mismatch: set `isSuggestionsLoading = true`, call repository, update cache and state

## New Composable Parameters

```kotlin
suggestedPrompts: List<String> = emptyList(),
isSuggestionsLoading: Boolean = false,
onSuggestionClick: (String) -> Unit = {},
```

## Visual Spec

| Element | Spec |
|---------|------|
| Section label | "Suggested for you" — 16sp, Medium weight, `#0B0B0B` |
| Spacing above label | 24dp (below preset chips) |
| Spacing below label | 12dp |
| Suggestion chip | Full width, RoundedCornerShape(16.dp), min height 44dp |
| Chip background | `#F0F7FF` (light blue tint) |
| Chip border | 1dp, `#49A9FF` |
| Chip text | 14sp, `#333333`, max 2 lines, ellipsis overflow |
| Chip left icon | `ic_wand`, 16dp, tinted `#49A9FF` |
| Chip padding | 12dp horizontal, 14dp vertical |
| Gap between chips | 8dp |
| Spacing below chips | 32dp (to generate button) |
| Loading state | Two shimmer placeholder rectangles (same chip dimensions) |
| Error/empty state | Hide section entirely (suggestions are optional) |

## Layout Placement

```
[Stepper: (-) 5 words (+)]
[Preset chips: 5  10  15  20]
  ↓ 24dp
[Label: "Suggested for you"]
  ↓ 12dp
[Suggestion chip 1]
  ↓ 8dp
[Suggestion chip 2]
  ↓ 32dp
[Generate CVC Words button]
```

## Interaction

- Tap suggestion chip → `onSuggestionClick(promptText)` → fills prompt text field
- Chips disabled when `isLoading == true` (generation in progress)
- Loading shimmer shown while `isSuggestionsLoading == true`
- If Gemini call fails, section hidden (no error shown to user)

## Data Flow

1. User taps magic wand → modal opens
2. Screen calls `viewModel.loadSuggestedPrompts()`
3. ViewModel checks cache → cache hit: instant state update → cache miss: Gemini call
4. Gemini returns 2 prompt strings
5. ViewModel updates `suggestedPrompts` state + cache
6. UI renders 2 suggestion chips
7. User taps chip → prompt text field populated

## Caching Strategy

- Cache key: `words.size` (simple count comparison)
- Cache stored in ViewModel private fields (survives recomposition, cleared on ViewModel death)
- Invalidation trigger: word bank size changes (add/delete word)
- First modal open after app launch: always calls Gemini (cache empty)

## Scope

- Add `generateSuggestedPrompts()` to `GeminiRepository.kt`
- Add suggestion state and caching to `LessonViewModel.kt`
- Add suggestion chips UI to `WordBankGenerationModal.kt`
- Update `WordBankScreen.kt` to wire new parameters
- Update preview composables
